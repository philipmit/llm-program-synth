#<PrevData>
print('********** Load and preview the dataset and datatypes')
##### define variables based on prompt
question='Is the rate of growth in the prevalence of arthritis higher in Omaha or Irvine?'
variable_text='the prevalence of arthritis'
city1='Omaha'
city2='Irvine'

##### function to fetch data
def fetch_data(city):
    query = variable_text+' in '+city
    URL1_with_query = URL1+query
    response = requests.post(URL1_with_query, headers=headers, json=data)
    res_data = json.loads(response.text)
    if not res_data['entities']:
        return None
    entity = res_data['entities'][0]
    for variable_i in res_data['variables']:
        if 'dc/' in variable_i:
            continue
        else:
            variable = variable_i
            break
    params = {
    "key": API_KEY,
    "entity.dcids": entity, 
    "select": ["entity", "variable", "value", "date"],
    "variable.dcids": variable
    }
    response = requests.get(URL2, params=params)
    print('response.text')
    print(response.text)
    return response.text, entity, variable

# collect data from Data Commons for city1
res1, entity1, variable1 = fetch_data(city1)
if res1 is None:
    print("No data available for city1:", city1)
# collect data from Data Commons for city2
res2, entity2, variable2 = fetch_data(city2)
if res2 is None:
    print("No data available for city2:", city2)
#</PrevData>

#<PrepData>
print('********** Prepare the dataset for analysis and visualization')
# function to get individual data for analysis
def get_data_for_analysis(res,entity,variable):
    obs_data = json.loads(res)
    print('obs_data')
    print(obs_data)
    entity_data = obs_data["byVariable"][variable]["byEntity"][entity]
    print('entity_data')
    print(entity_data)
    print('type(entity_data)')
    print(type(entity_data))
    seq_data = entity_data["orderedFacets"][0]['observations']
    print('seq_data')
    print(seq_data)
    print('type(seq_data)')
    print(type(seq_data))
    print('len(seq_data)')
    print(len(seq_data))
    return seq_data

# get data for city1
if res1 is not None:
    seq_data1 = get_data_for_analysis(res1, entity1, variable1)
# get data for city2
if res2 is not None:
    seq_data2 = get_data_for_analysis(res2, entity2, variable2)
#</PrepData>
